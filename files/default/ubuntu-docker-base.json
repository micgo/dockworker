{
  "builders": [
    {
      "type": "docker",
      "image": "ubuntu",
      "export_path": "ubuntu_base.tar"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "name": "shell-setup",
      "inline": ["sudo apt-get update",
                "sudo apt-get -y install curl"
      ]
    },
    {
      "type": "chef-solo",
      "name": "chef-image-prep",
      "cookbook_paths": ["/tmp/cookbooks"],
      "json": {
        "name": "ubuntu_base",
        "run_list": []
      }
    },
    {
      "type": "shell",
      "name": "shell-cookbook-load",
      "inline": ["sudo apt-get install git-core",
                "cd /tmp",
                "sudo /opt/chef/embedded/bin/gem install berkshelf --no-ri --no-rdoc",
                "git clone https://github.com/micgo/dockworker.git /tmp/cookbooks/dockworker",
                "cd /tmp/cookbooks/dockworker",
                "/opt/chef/embedded/bin/berks install --path /tmp/cookbooks"
      ]
    },
    {
      "type": "chef-solo",
      "name": "chef-image-build",
      "cookbook_paths": ["/tmp/cookbooks"],
      "json": {
        "name": "ubuntu_base",
        "run_list": [
          "recipe[supervisor]",
          "recipe[dockworker::base_image]"
        ]
      }
    }
  ]
}
